#!/bin/bash
set -x
set -e
cd "$(dirname "$0")"/..

GIT_HASH=$(git rev-parse HEAD | cut -c -7)
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)
DOCKER_REGISTRY=gcr.io/cloud-armory
export DOCKER_IMAGE=${DOCKER_REGISTRY}/${GIT_REPO}:${GIT_HASH}
export PUSHED_IMAGE=${DOCKER_REGISTRY}/${GIT_REPO}:${BRANCH_NAME}-${GIT_HASH}

docker tag "${DOCKER_IMAGE}" "${PUSHED_IMAGE}"
arm login
docker push "${PUSHED_IMAGE}"
