#!/bin/bash -xe
#     :::     :::::::::  ::::    ::::   ::::::::  :::::::::  :::   :::
#   :+: :+:   :+:    :+: +:+:+: :+:+:+ :+:    :+: :+:    :+: :+:   :+:
#  +:+   +:+  +:+    +:+ +:+ +:+:+ +:+ +:+    +:+ +:+    +:+  +:+ +:+
# +#++:++#++: +#++:++#:  +#+  +:+  +#+ +#+    +:+ +#++:++#:    +#++:
# +#+     +#+ +#+    +#+ +#+       +#+ +#+    +#+ +#+    +#+    +#+
# #+#     #+# #+#    #+# #+#       #+# #+#    #+# #+#    #+#    #+#
# ###     ### ###    ### ###       ###  ########  ###    ###    ##

cd "$(dirname "$0")/.."

source bin/ENV

if [[ ! -z "$DINGHY_HASH" ]]; then
	echo "Setting Open Core Dinghy to Version ${DINGHY_HASH}"
	OCDINGHY_HASH=${DINGHY_HASH}
else
	echo "DINGHY_HASH not set; updating Open Core Dinghy to master."
	OCDINGHY_HASH="master"
fi

echo "Building binary first..."
WORKDIR=/go/src/github.com/armory-io/dinghy
echo "Building docker image ${DOCKER_IMAGE}..."
docker build --build-arg OCDINGHY_HASH=${OCDINGHY_HASH} -f ./Dockerfile -t ${DOCKER_IMAGE} .
