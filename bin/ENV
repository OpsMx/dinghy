#!/bin/bash -e

if [[ ! -f ./${GIT_REPO}_version ]]; then
    STORED_VERSION=$(date +%Y-%m-%d)
else
    STORED_VERSION=$(cat "./${GIT_REPO}_version")
fi

if [[ -z "$DOCKER_TAG" ]]; then
    GIT_HASH=`git rev-parse --short HEAD`
    PREFIX=dev
    DOCKER_TAG="${STORED_VERSION}-${GIT_HASH}-${PREFIX}0000"
fi

export DOCKER_REGISTRY="docker.io/armory"
export DOCKER_IMAGE="docker.io/armory/${GIT_REPO}:${DOCKER_TAG}"
