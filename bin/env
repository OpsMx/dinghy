#!/bin/bash -xe

export DOCKER_REGISTRY=${DOCKER_REGISTRY:-"armory"}
export GIT_REPO=${GIT_REPO:-"dinghy"}
export GIT_HASH=${GIT_HASH:-$(git rev-parse --short HEAD)}
export BUILD_NUMBER=${BUILD_NUMBER:-0}
export BRANCH_NAME=${BRANCH_NAME:-$(git rev-parse --abbrev-ref HEAD)}

export DINGHY_VERSION=$(cat dinghy_version)
export CONTAINER_VERSION=${BRANCH_NAME}-${GIT_HASH}
export DOCKER_IMAGE=${DOCKER_REGISTRY}/${GIT_REPO}:${CONTAINER_VERSION}
export PUSHED_IMAGE=${DOCKER_IMAGE}
export HALYARD_DOCKER_IMAGE=${DOCKER_REGISTRY}/dinghy:${DINGHY_VERSION}-b${BUILD_NUMBER}-${GIT_HASH}